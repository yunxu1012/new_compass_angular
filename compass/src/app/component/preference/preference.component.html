<div class="box">
  <app-menu></app-menu>
  <div class="profile-container">
    <div>
      <label class="titleRow">
        <h2>User Preference</h2>
      </label>
    </div>
    @if (!isEditMode) {
    <div>
      <div class="rowClass">
        <label class="textLabel">Home Type:</label>
        {{customerPreference?.hometypes|json}}
      </div>
      <div class="rowClass">
        <label class="textLabel">Min Price:</label>
        <label class="valueLabel">{{ customerPreference?.minPrice }} </label>
        <label class="textLabel">Max Price:</label>
        <label class="valueLabel">{{ customerPreference?.maxPrice }}</label>
      </div>
      <div class="rowClass">
        <label class="textLabel">Min Bed:</label>
        <label class="valueLabel">{{ getBedCountByKey(customerPreference?.minBed) }} </label>
        <label class="textLabel">Max Bed:</label>
        <label class="valueLabel">{{ getBedCountByKey(customerPreference?.maxBed) }}</label>
      </div>
      <div class="rowClass">
        <label class="textLabel">Min Bath:</label>
        <label class="valueLabel">{{ getBathCountByKey(customerPreference?.minBath) }}</label>
      </div>
      <div class="rowClass">
        <label class="textLabel">Min Square Feet:</label>
        <label class="valueLabel">{{ customerPreference?.minSquareFeet }}</label>
        <label class="textLabel">Max Square Feet:</label>
        <label class="valueLabel">{{ customerPreference?.maxSquareFeet }}</label>
      </div>
    </div>
    <p>
      Your Preferred Cities are: {{selectedCityNames | json}}
    </p>
    <div>
      <div class="buttonRow">
        <button (click)="toggleEditMode()">Edit</button>
      </div>
    </div>
    }

    @if (isEditMode) {
    <form [formGroup]="preferenceForm">
      <div class="rowClass">
        <label class="labelClass">Home Type:</label>
        <ng-select id="homeType" [items]="hometypes" #selectedItem class="my-custom-select" [searchable]="true"
         [multiple]="true" formControlName="selectedHometypes">
          <ng-template ng-multi-label-tmp>
            <span style="display:inline-block" class="ng-placeholder"></span>
          </ng-template>
        </ng-select>
      </div>
      <div class="rowClass">
        <div>
          @if (preferenceForm.get('selectedHometypes')?.hasError('required') &&
          preferenceForm.get('selectedHometypes')?.touched) {
          <label class="error">
            Home Type is required.
          </label>
          }
        </div>
      </div>
      <div class="rowClass">
        <label class="labelClass" for="minPrice">Min Price:</label>
        <input id="minPrice" type="text" formControlName="minPrice">
        <label class="labelClass" for="maxPrice">Max Price:</label>
        <input id="maxPrice" type="text" formControlName="maxPrice">
      </div>
      <div class="rowClass">
        <div>
          @if (preferenceForm.get('minPrice')?.hasError('required') &&
          preferenceForm.get('minPrice')?.touched) {
          <label class="error">
            Min Price is required.
          </label>
          }
          @if (preferenceForm.get('maxPrice')?.hasError('required') &&
          preferenceForm.get('maxPrice')?.touched) {
          <label class="error">
            Max Price is required.
          </label>
          }
          @if (preferenceForm.get('maxPrice')?.hasError('priceError')
          && preferenceForm.get('maxPrice')?.touched) {
          <label class="error">
            &nbsp;&nbsp; Min Price can't be greater than max price.
          </label>
          }
        </div>
      </div>
      <div class="rowClass">
        <label class="labelClass">Min Bed:</label>
        <select id="minBed" formControlName="minBed">
          <option [ngValue]=""></option>
          @for (opMinBed of bedCounts; track opMinBed) {
          <option [ngValue]="opMinBed">
            {{ getBedCountByKey(opMinBed) }}
          </option>
          }
        </select>
        <label class="labelClass">Max Bed:</label>
        <select id="maxBed" formControlName="maxBed">
          <option [ngValue]=""></option>
          @for (opMaxBed of bedCounts; track opMaxBed) {
          <option [ngValue]="opMaxBed">
            {{ getBedCountByKey(opMaxBed) }}
          </option>
          }
        </select>
      </div>
      <div class="rowClass">
        <div>
          @if (preferenceForm.get('minBed')?.hasError('required') &&
          preferenceForm.get('minBed')?.touched) {
          <label class="error">
            Min Bed is required.
          </label>
          }
          @if (preferenceForm.get('maxBed')?.hasError('required') &&
          preferenceForm.get('maxBed')?.touched) {
          <label class="error">
            Max Bed is required.
          </label>
          }
          @if (preferenceForm.get('maxBed')?.hasError('bedError')
          && preferenceForm.get('maxBed')?.touched) {
          <label class="error">
            &nbsp;&nbsp; Min Bed can't be greater than Max Bed.
          </label>
          }
        </div>
      </div>
      <div class="rowClass">
        <label class="labelClass">Min Bath:</label>
        <select id="minBath" formControlName="minBath">
          <option [ngValue]=""></option>
          @for (opMinBath of bathCounts; track opMinBath) {
          <option [ngValue]="opMinBath">
            {{ getBathCountByKey(opMinBath) }}
          </option>
          }
        </select>
      </div>
      <div class="rowClass">
        <div>
          @if (preferenceForm.get('minBath')?.hasError('required') &&
          preferenceForm.get('minBath')?.touched) {
          <label class="error">
            Min Bath is required.
          </label>
          }
        </div>
      </div>
      <div class="rowClass">
        <label class="labelClass" for="minSquareFeet">Min Square Feet:</label>
        <input id="minSquareFeet" type="text" formControlName="minSquareFeet">
        <label class="labelClass" for="maxSquareFeet">Max Square Feet:</label>
        <input id="maxSquareFeet" type="text" formControlName="maxSquareFeet">
      </div>
      <div class="rowClass">
        @if (preferenceForm.get('minSquareFeet')?.hasError('required')
        && preferenceForm.get('minSquareFeet')?.touched) {
        <label class="error">
          Min Square Feet is required.
        </label>
        }
        @if (preferenceForm.get('maxSquareFeet')?.hasError('required')
        && preferenceForm.get('maxSquareFeet')?.touched) {
        <div class="error">
          Max Square Feet is required.
        </div>
        }
        @if (preferenceForm.get('maxSquareFeet')?.hasError('squareFeetError')
        && preferenceForm.get('maxSquareFeet')?.touched) {
        <label class="error">
          &nbsp;&nbsp; Min Squrare Feet can't be greater than Max Square Feet.
        </label>
        }
      </div>
      <div>
      </div>
      <p>
        Your Preferred Cities are: {{selectedCityNames | json}}
      </p>
      <div>
        <p>
          Please select up to 10 preferred cities
        </p>

        <ng-select [items]="cities" #selectedItem class="my-custom-select" bindLabel="name" [searchable]="true"
          (change)="selected($event)" [multiple]="true" formControlName="selectedCities">
          <ng-template ng-multi-label-tmp>
            <span style="display:block" class="ng-placeholder"></span>
          </ng-template>

        </ng-select>




      </div>


      <div class="buttonRow">
        <button type="submit" (click)="savePreference()">Save</button>
        <button type="button" (click)="cancelEdit()">Cancel</button>
      </div>
    </form>
    }
  </div>